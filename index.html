<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Task Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a2e0c6cf13.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="css/style.css">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden; /* hides scrollbars */
    }

    body {
      background-image: url('images/bg.png');
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      height: 100vh;
    }
  </style>

  
</head>

<body>
<div class="container shadow p-4 bg-white rounded">
  <!-- Header -->
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <h3 class="text-primary fw-bold">Task Manager</h3>
      <div class="d-flex align-items-center w-100 ms-4">
        <input
          type="text"
          id="taskSearch"
          class="form-control me-2 flex-grow-1"
          placeholder="Search tasks..."
        />
        <button
        type="button"
        id="addTaskBtn"
        class="btn btn-primary btn-sm"
        data-bs-toggle="modal"
        data-bs-target="#taskModal"
      >
        Add Task
      </button>
      
      </div>
    </div>
  </div>
  

  <!--Modal -->


  <!-- Task Modal -->
<div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="taskForm">
        <div class="modal-header">
          <h5 class="modal-title" id="taskModalLabel">Add / Edit Task</h5>
        </div>
        <div class="modal-body d-flex flex-wrap gap-2">
          <input
            type="text"
            id="taskInput"
            class="form-control"
            placeholder="Enter task name..."
            required
            style="min-width: 200px;"
          />
          <textarea
            id="taskDescription"
            class="form-control"
            placeholder="Enter task description..."
            rows="1"
            style="min-width: 250px;"
          ></textarea>

          <input
            type="date"
            id="dueDate"
            class="form-control"
            style="width: 180px;"
            placeholder="Due Date"
          />
          <select
            id="priorityLevel"
            class="form-select"
            style="width: 130px;"
            required
          >
            <option value="" disabled selected>Priority Level</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>
          <select id="taskTabSelect" class="form-select" style="width: 150px;">
            <option value="accenture">Accenture</option>
            <option value="constellation">Constellation</option>
          </select>
          <input type="hidden" id="editIndex" />
          <input type="hidden" id="editTab" />
        </div>
        <div class="modal-footer">
          <button type="submit" id="saveTaskBtn" class="btn add-btn">Save</button>
          <button type="button" id ="cancelTaskBtn" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

  

  <!-- Add/Edit Form (hidden initially) -->
  <!---<div id="taskFormContainer" class="mb-4" style="display:none;">
    <form id="taskForm" class="d-flex flex-wrap align-items-center gap-2">
      <input
        type="text"
        id="taskInput"
        class="form-control"
        placeholder="Enter task name..."
        required
        style="min-width: 200px;"
      />
      <textarea
        id="taskDescription"
        class="form-control"
        placeholder="Enter task description..."
        rows="1"
        style="min-width: 250px;"
      ></textarea>
      <select
        id="priorityLevel"
        class="form-select"
        style="width: 130px;"
        required
      >
        <option value="" disabled selected>Priority Level</option>
        <option value="High">High</option>
        <option value="Medium">Medium</option>
        <option value="Low">Low</option>
      </select>
      <select id="taskTabSelect" class="form-select" style="width: 150px;">
        <option value="accenture">Accenture</option>
        <option value="constellation">Constellation</option>
      </select>
      <button type="submit" id="saveTaskBtn" class="btn add-btn">Save</button>
      <button type="button" id="cancelTaskBtn" class="btn btn-secondary">Cancel</button>
      <input type="hidden" id="editIndex" />
      <input type="hidden" id="editTab" />
    </form>
  </div>-->

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="taskTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="accenture-tab"
        data-bs-toggle="tab"
        data-bs-target="#accenture"
        type="button"
        role="tab"
        aria-controls="accenture"
        aria-selected="true"
      >Accenture Tasks</button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="constellation-tab"
        data-bs-toggle="tab"
        data-bs-target="#constellation"
        type="button"
        role="tab"
        aria-controls="constellation"
        aria-selected="false"
      >Constellation Tasks</button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="taskTabsContent">
    <div class="tab-pane fade show active" id="accenture" role="tabpanel" aria-labelledby="accenture-tab">
      <table class="table table-hover align-middle task-table" id="accentureTable">
        <thead>
          <tr>
            <th>SN</th>
            <th>Task</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="tab-pane fade" id="constellation" role="tabpanel" aria-labelledby="constellation-tab">
      <table class="table table-hover align-middle task-table" id="constellationTable">
        <thead>
          <tr>
            <th>SN</th>
            <th>Task</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<script>
  // Main app logic
  document.addEventListener('DOMContentLoaded', () => {
    const addTaskBtn = document.getElementById('addTaskBtn');
    //const taskFormContainer = document.getElementById('taskFormContainer');
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const taskDescription = document.getElementById('taskDescription');
    const priorityLevel = document.getElementById('priorityLevel');
    const taskTabSelect = document.getElementById('taskTabSelect');
    const saveTaskBtn = document.getElementById('saveTaskBtn');
    const cancelTaskBtn = document.getElementById('cancelTaskBtn');
    const editIndexInput = document.getElementById('editIndex');
    const editTabInput = document.getElementById('editTab');
    const searchInput = document.getElementById('taskSearch');
    const dueDateInput = document.getElementById('dueDate');

// Prevent selecting past dates based on local time
function setMinDueDate() {
  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const day = String(today.getDate()).padStart(2, '0');
  const localDate = `${year}-${month}-${day}`;
  dueDateInput.setAttribute('min', localDate);
}
setMinDueDate();




    // Data structure holding tasks
    let tasks = {
      accenture: [
        { name: "Accenture Task 1", description: "Description 1", priority: "High", done: false },
        { name: "Accenture Task 2", description: "Description 2", priority: "Medium", done: false },
        { name: "Accenture Task 3", description: "Description 3", priority: "Low", done: false },
      ],
      constellation: [
        { name: "Constellation Task 1", description: "Description A", priority: "High", done: false },
        { name: "Constellation Task 2", description: "Description B", priority: "Medium", done: false },
        { name: "Constellation Task 3", description: "Description C", priority: "Low", done: false },
      ],
    };

    // Load tasks from localStorage if exists
    if (localStorage.getItem('tasksData')) {
      tasks = JSON.parse(localStorage.getItem('tasksData'));
    }

    function saveTasksToStorage() {
      localStorage.setItem('tasksData', JSON.stringify(tasks));
    }

    // Helper for badge classes based on priority
    function priorityBadgeClass(priority) {
      switch (priority) {
        case 'High': return 'badge badge-high';
        case 'Medium': return 'badge badge-medium';
        case 'Low': return 'badge badge-low';
        default: return 'badge bg-secondary';
      }
    }


    function formatDate(dateStr) {
  // Check if dateStr is a string and looks like a date
  if (!dateStr) return '';
  // If it's already a string in YYYY-MM-DD, convert to nicer format
  const d = new Date(dateStr);
  if (isNaN(d)) return dateStr; // fallback to raw string if invalid date

  // Format to readable form: e.g. Jul 21, 2025
  const options = { year: 'numeric', month: 'short', day: 'numeric' };
  return d.toLocaleDateString(undefined, options);
}


    // Render tasks in the table
    function renderTasks() {
  ['accenture', 'constellation'].forEach(tab => {
    const tbody = document.querySelector(`#${tab}Table tbody`);
    tbody.innerHTML = '';

    // Sort tasks by priority
    const priorityOrder = { 'High': 1, 'Medium': 2, 'Low': 3 };
    tasks[tab].sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);

    tasks[tab].forEach((task, idx) => {
      const tr = document.createElement('tr');

      const checkboxHTML = `<input type="checkbox" class="form-check-input me-2" ${task.done ? 'checked' : ''} data-tab="${tab}" data-index="${idx}">`;

      tr.innerHTML = `
  <td>${idx + 1}</td>
  <td>
    ${checkboxHTML} <strong>${task.name}</strong><br />
    <div class="task-desc" <small class="text-muted">Task Description: ${task.description || ''}</div>
    ${task.dueDate ? `<small class="text-muted">Due date: ${formatDate(task.dueDate)}</small>` : ''}
    <span class="${priorityBadgeClass(task.priority)}">${task.priority || 'N/A'}</span><br/>
   
  </td>
  <td class="text-end">
    <button onclick="viewTask('${tab}', ${idx})" class="btn btn-sm btn-view me-1" title="View">
      <i class="fas fa-eye" style="color: blue;"></i> View
    </button>
    <button class="btn btn-sm btn-edit me-1" title="Edit" data-tab="${tab}" data-index="${idx}">
      <i class="fas fa-edit"></i> Edit
    </button>
    <button class="btn btn-sm btn-delete" title="Delete" data-tab="${tab}" data-index="${idx}">
      <i class="fas fa-trash-alt"></i> Delete
    </button>
  </td>
`;
tbody.appendChild(tr);

    });
  });
}


    // Show form for Add or Edit
   // function showForm(isEdit = false, tab = 'accenture', index = null) {
      //taskFormContainer.style.display = 'block';
      //taskInput.focus();
      //if (isEdit) {
       // const task = tasks[tab][index];
       // taskInput.value = task.name;
        //taskDescription.value = task.description || '';
        //priorityLevel.value = task.priority || '';
       // taskTabSelect.value = tab;
        //editIndexInput.value = index;
        //editTabInput.value = tab;
        //saveTaskBtn.textContent = 'Update Task';
     // } else {
        //taskInput.value = '';
       // taskDescription.value = '';
       // priorityLevel.value = '';
       // taskTabSelect.value = currentTab();
       // editIndexInput.value = '';
       // editTabInput.value = '';
       // saveTaskBtn.textContent = 'Add Task';
      //}
    //}

    
  // function hideForm() {
    //  taskFormContainer.style.display = 'none';
      //taskInput.value = '';
      //taskDescription.value = '';
      //priorityLevel.value = '';
      //editIndexInput.value = '';
      //editTabInput.value = '';
    //}


    function showFormModal(isEdit = false, tab = 'accenture', index = null) {
  const modal = new bootstrap.Modal(document.getElementById('taskModal'));
  if (isEdit) {
    const task = tasks[tab][index];
    taskInput.value = task.name;
    taskDescription.value = task.description || '';
    priorityLevel.value = task.priority || '';
    dueDateInput.value = task.dueDate || '';
    taskTabSelect.value = tab;
    editIndexInput.value = index;
    editTabInput.value = tab;
    saveTaskBtn.textContent = 'Update Task';
  } else {
    taskForm.reset();  // Clear the form completely
    dueDateInput.value = '';
    taskTabSelect.value = tab;
    editIndexInput.value = '';
    editTabInput.value = '';
    saveTaskBtn.textContent = 'Add Task';
  }
  modal.show();
}


function closeModal() {
  const modalEl = document.getElementById('taskModal');
  const modalInstance = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
  modalInstance.hide();

  // Wait for modal to fully hide, then remove the backdrop
  setTimeout(() => {
    document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
    document.body.classList.remove('modal-open');
    document.body.style.paddingRight = ''; // Reset padding if set
  }, 300); // Bootstrap transition delay
}


    function currentTab() {
      const activeTab = document.querySelector('#taskTabs .nav-link.active');
      return activeTab.id.includes('accenture') ? 'accenture' : 'constellation';
    }

    // Event: Add Task button click
   //addTaskBtn.addEventListener('click', () => showForm(false));

   addTaskBtn.addEventListener('click', () => showFormModal(false, currentTab()));


    // Event: Cancel button click on form
    document.getElementById('cancelTaskBtn').addEventListener('click', function () {
  document.body.classList.remove('modal-open');
  document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
});



    // Event: Submit Add/Edit Task form
    taskForm.addEventListener('submit', e => {
  e.preventDefault();
  const taskName = taskInput.value.trim();
  const taskDesc = taskDescription.value.trim();
  const priority = priorityLevel.value;
  const dueDate = dueDateInput.value;
  if (!taskName) return Swal.fire('Error', 'Task name cannot be empty', 'error');
  if (!priority) return Swal.fire('Error', 'Please select a priority level', 'error');
  const tab = taskTabSelect.value;
  const editIndex = editIndexInput.value;

  if (priority.toLowerCase() === 'high' && dueDate) {
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const due = new Date(dueDate);
    due.setHours(0, 0, 0, 0);

    const diffTime = due - today;
    const diffDays = diffTime / (1000 * 60 * 60 * 24);

    if (diffDays == 1) {
      return Swal.fire({
        icon: 'warning',
        title: 'Invalid Due Date',
        text: 'For high-priority tasks, please select the earliest date to accomplish the task.',
      });
    }
  }

  if (editIndex !== '') {
    tasks[tab][editIndex] = {
      ...tasks[tab][editIndex],
      name: taskName,
      description: taskDesc,
      priority,
      dueDate,
    };
  } else {
    tasks[tab].push({ name: taskName, description: taskDesc, priority, done: false, dueDate });
  }
  saveTasksToStorage();
  renderTasks();

  closeModal();

  // Optional: Sweet alert for success after saving (if you want)
  // Swal.fire({
  //   icon: 'success',
  //   title: 'Saved!',
  //   text: 'Your task has been saved successfully.',
  //   timer: 1500,
  //   showConfirmButton: false
  // });
});


    // Event delegation for Edit, Delete, and checkbox toggle
    document.querySelectorAll('.task-table tbody').forEach(tbody => {
      tbody.addEventListener('click', e => {
        const target = e.target.closest('button');
        if (!target) return;

        const tab = target.getAttribute('data-tab');
        const index = target.getAttribute('data-index');
        if (!tab || index === null) return;

        if (target.classList.contains('btn-edit')) {
          // Edit
         // showForm(true, tab, index);
         showFormModal(true, tab, index);

         
     //   } else if (target.classList.contains('btn-delete')) {
          // Delete
       //   if (confirm('Are you sure you want to delete this task?')) {
            //tasks[tab].splice(index, 1);
        //    saveTasksToStorage();
          //  renderTasks();
         // }
        //}

        }else if (target.classList.contains('btn-delete')) {
          Swal.fire({
            title: 'Are you sure?',
            text: "This task will be permanently deleted.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#e74c3c',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, delete it!'
      
        }).then((result) => {
          if (result.isConfirmed) {
       tasks[tab].splice(index, 1);
       saveTasksToStorage();
       renderTasks();
 
       Swal.fire({
         title: 'Deleted!',
         text: 'The task has been deleted.',
         icon: 'success',
         timer: 1500,
         showConfirmButton: false
       });
     }
   });
 }
        


        
      });
    });

    // Checkbox toggle done state event delegation
    document.querySelectorAll('.task-table tbody').forEach(tbody => {
      tbody.addEventListener('change', e => {
        const cb = e.target;
        if (cb.tagName.toLowerCase() !== 'input' || cb.type !== 'checkbox') return;

        const tab = cb.getAttribute('data-tab');
        const index = cb.getAttribute('data-index');
        if (!tab || index === null) return;

        tasks[tab][index].done = cb.checked;
        saveTasksToStorage();
        renderTasks();
      });
    });

    // Search functionality (simple filter on visible rows)
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.toLowerCase();

      document.querySelectorAll('.task-table tbody tr').forEach(tr => {
        const taskName = tr.querySelector('td:nth-child(2) strong').textContent.toLowerCase();
        const taskDesc = tr.querySelector('.task-desc').textContent.toLowerCase();
        tr.style.display = (taskName.includes(q) || taskDesc.includes(q)) ? '' : 'none';
      });
    });

    // View task alert
// Replace both definitions with this unified viewTask function:
window.viewTask = function(tab, index) {
  const task = tasks[tab]?.[index];
  if (!task) {
    alert('Task not found.');
    return;
  }
  localStorage.setItem('selectedTask', JSON.stringify(task));
  window.location.href = 'view-task.html';  // Adjust if needed
};

renderTasks();
});

</script>
</body>
</html>
